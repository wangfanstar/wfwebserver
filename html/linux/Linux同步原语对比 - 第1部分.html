<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinuxåŒæ­¥åŸè¯­å¯¹æ¯”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .sidebar {
            position: fixed;
            width: 240px;
            height: 100vh;
            overflow-y: auto;
            scrollbar-width: thin;
            background-color: #2d3748;
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 3px;
        }
        
        .nav-link {
            display: block;
            padding: 0.75rem 1rem;
            color: #e2e8f0;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background-color: #4a5568;
            border-left-color: #63b3ed;
        }
        
        .nav-link.active {
            background-color: #4a5568;
            border-left-color: #4299e1;
            font-weight: 600;
        }
        
        .main-content {
            margin-left: 240px;
            padding: 1.5rem;
        }
        
        .comparison-table th {
            padding: 0.75rem;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 1rem 0.75rem;
            vertical-align: top;
        }
        
        .section-container {
            transition: transform 0.2s;
        }
        
        .section-container:hover {
            transform: translateY(-2px);
        }
        
        code {
            font-family: 'Cascadia Code', 'Source Code Pro', monospace;
            background-color: #edf2f7;
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
            color: #2c5282;
        }
        
        pre {
            background-color: #f8fafc;
            border-radius: 0.375rem;
            padding: 1rem;
            overflow-x: auto;
            border: 1px solid #e2e8f0;
            margin: 0.5rem 0;
        }
        
        pre code {
            background-color: transparent;
            padding: 0;
            color: #1a202c;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .api-list {
            column-count: 1;
        }
        
        @media (min-width: 1024px) {
            .api-list {
                column-count: 2;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- å›ºå®šåœ¨å·¦ä¾§çš„å¯¼èˆªæ  -->
    <aside class="sidebar">
        <div class="p-4 border-b border-gray-700">
            <h1 class="text-xl font-bold text-white">LinuxåŒæ­¥åŸè¯­å¯¹æ¯”</h1>
            <p class="text-sm text-gray-400 mt-1">ç”¨æˆ·æ€ä¸å†…æ ¸æ€</p>
        </div>
        <nav class="pt-2">
            <a href="#mutex" class="nav-link active">
                <span class="mr-2">ğŸ”’</span> äº’æ–¥é” (Mutex)
            </a>
            <a href="#rwlock" class="nav-link">
                <span class="mr-2">ğŸ“–</span> è¯»å†™é” (RW Lock)
            </a>
            <a href="#spinlock" class="nav-link">
                <span class="mr-2">ğŸ”„</span> è‡ªæ—‹é” (Spinlock)
            </a>
            <a href="#semaphore" class="nav-link">
                <span class="mr-2">ğŸš¦</span> ä¿¡å·é‡ (Semaphore)
            </a>
            <a href="#seqlock" class="nav-link">
                <span class="mr-2">ğŸ“‘</span> é¡ºåºé” (SeqLock)
            </a>
            <a href="#rcu" class="nav-link">
                <span class="mr-2">ğŸ”„</span> RCU
            </a>
            <a href="#atomic" class="nav-link">
                <span class="mr-2">âš›ï¸</span> åŸå­æ“ä½œ (Atomic)
            </a>
            <a href="#futex" class="nav-link">
                <span class="mr-2">â±ï¸</span> Futex
            </a>
            <div class="mt-4 p-4 bg-gray-800 text-xs text-gray-400">
                <p class="font-semibold text-gray-300 mb-1">å¯¼èˆªè¯´æ˜</p>
                <p>ç‚¹å‡»é“¾æ¥å¯ç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„åŒæ­¥åŸè¯­è¯¦æƒ…ã€‚</p>
            </div>
        </nav>
    </aside>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content pb-12">
        <div class="max-w-6xl mx-auto">
            <!-- ä»‹ç» -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h1 class="text-3xl font-bold mb-4">LinuxåŒæ­¥åŸè¯­å¯¹æ¯”</h1>
                <p class="text-lg text-gray-700 mb-4">
                    æœ¬æ–‡æ¡£æ¯”è¾ƒäº†Linuxç³»ç»Ÿä¸­ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„å„ç§åŒæ­¥åŸè¯­ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„APIã€ä½¿ç”¨æ–¹å¼å’Œç‰¹ç‚¹ã€‚
                </p>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-md">
                    <p class="font-semibold text-blue-800">æ³¨æ„äº‹é¡¹</p>
                    <ul class="list-disc ml-6 text-blue-700 mt-1">
                        <li>åŒæ­¥åŸè¯­çš„é€‰æ‹©åº”åŸºäºå…·ä½“ä½¿ç”¨åœºæ™¯</li>
                        <li>å†…æ ¸æ€çš„åŒæ­¥åŸè¯­æœ‰æ›´ä¸¥æ ¼çš„ä½¿ç”¨è§„åˆ™</li>
                        <li>æŸäº›åŒæ­¥åŸè¯­åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­ä¸åº”ä½¿ç”¨ï¼ˆå¦‚ä¸­æ–­ä¸Šä¸‹æ–‡ï¼‰</li>
                        <li>ç†è§£å„ç§åŒæ­¥åŸè¯­çš„ç‰¹æ€§å¯¹äºå¼€å‘é«˜æ€§èƒ½ã€æ— ç«äº‰çš„å¤šçº¿ç¨‹ç¨‹åºè‡³å…³é‡è¦</li>
                    </ul>
                </div>
            </div>

            <!-- äº’æ–¥é” -->
            <div id="mutex" class="section-container bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 pb-2 border-b border-gray-200 flex items-center">
                    <span class="mr-2 text-blue-600">ğŸ”’</span> äº’æ–¥é” (Mutex)
                </h2>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mb-6">
                    <p class="font-medium">äº’æ–¥é”æ˜¯æœ€åŸºæœ¬å’Œä½¿ç”¨æœ€å¹¿æ³›çš„åŒæ­¥åŸè¯­ï¼Œç”¨äºç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚</p>
                </div>
                
                <table class="comparison-table w-full border-collapse mb-4">
                    <tr class="bg-gray-100 rounded-t-lg">
                        <th class="border border-gray-300 rounded-tl-lg text-center w-1/2">ç”¨æˆ·æ€ (User Space)</th>
                        <th class="border border-gray-300 rounded-tr-lg text-center w-1/2">å†…æ ¸æ€ (Kernel Space)</th>
                    </tr>
                    
                    <!-- å¤´æ–‡ä»¶ -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å¤´æ–‡ä»¶:</p>
                            <code class="block my-2">#include &lt;pthread.h&gt;</code>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å¤´æ–‡ä»¶:</p>
                            <code class="block my-2">#include &lt;linux/mutex.h&gt;</code>
                        </td>
                    </tr>
                    
                    <!-- ä¸»è¦API -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">ä¸»è¦API:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>pthread_mutex_init()</code></li>
                                    <li><code>pthread_mutex_destroy()</code></li>
                                    <li><code>pthread_mutex_lock()</code></li>
                                    <li><code>pthread_mutex_trylock()</code></li>
                                    <li><code>pthread_mutex_unlock()</code></li>
                                    <li><code>pthread_mutex_timedlock()</code></li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">äº’æ–¥é”å±æ€§:</p>
                            <div class="mt-2">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>pthread_mutexattr_init()</code></li>
                                    <li><code>pthread_mutexattr_destroy()</code></li>
                                    <li><code>pthread_mutexattr_settype()</code></li>
                                    <li>ç±»å‹: 
                                        <ul class="list-disc ml-6 mt-1 space-y-1">
                                            <li><code>PTHREAD_MUTEX_NORMAL</code></li>
                                            <li><code>PTHREAD_MUTEX_RECURSIVE</code></li>
                                            <li><code>PTHREAD_MUTEX_ERRORCHECK</code></li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">ä¸»è¦API:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>DEFINE_MUTEX(mutexname)</code></li>
                                    <li><code>mutex_init()</code></li>
                                    <li><code>mutex_lock()</code></li>
                                    <li><code>mutex_lock_interruptible()</code></li>
                                    <li><code>mutex_lock_killable()</code></li>
                                    <li><code>mutex_trylock()</code></li>
                                    <li><code>mutex_unlock()</code></li>
                                    <li><code>mutex_is_locked()</code></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- ä½¿ç”¨ç¤ºä¾‹ -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">ä½¿ç”¨ç¤ºä¾‹:</p>
                            <pre><code>// å®šä¹‰äº’æ–¥é”
pthread_mutex_t mutex;

// åˆå§‹åŒ–é»˜è®¤äº’æ–¥é”
pthread_mutex_init(&mutex, NULL);

// è·å–é”
pthread_mutex_lock(&mutex);
// ä¸´ç•ŒåŒºä»£ç 
// ...
// é‡Šæ”¾é”
pthread_mutex_unlock(&mutex);

// å°è¯•è·å–é”ï¼ˆéé˜»å¡ï¼‰
if (pthread_mutex_trylock(&mutex) == 0) {
    // æˆåŠŸè·å–é”
    // ä¸´ç•ŒåŒºä»£ç 
    // ...
    pthread_mutex_unlock(&mutex);
}

// é€’å½’é”ç¤ºä¾‹
pthread_mutexattr_t attr;
pthread_mutex_t recursive_mutex;

pthread_mutexattr_init(&attr);
pthread_mutexattr_settype(&attr, 
    PTHREAD_MUTEX_RECURSIVE);
pthread_mutex_init(&recursive_mutex, &attr);
pthread_mutexattr_destroy(&attr);

// å¯ä»¥å¤šæ¬¡é”å®šé€’å½’é”
pthread_mutex_lock(&recursive_mutex);
pthread_mutex_lock(&recursive_mutex); // ä¸ä¼šé˜»å¡
pthread_mutex_unlock(&recursive_mutex);
pthread_mutex_unlock(&recursive_mutex);</code></pre>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">ä½¿ç”¨ç¤ºä¾‹:</p>
                            <pre><code>// å®šä¹‰äº’æ–¥é”
struct mutex my_mutex;

// åˆå§‹åŒ–
mutex_init(&my_mutex);

// åŸºæœ¬ä½¿ç”¨
mutex_lock(&my_mutex);
// ä¸´ç•ŒåŒºä»£ç 
// ...
mutex_unlock(&my_mutex);

// å¯ä¸­æ–­è·å–é”
if (mutex_lock_interruptible(&my_mutex) != 0) {
    // è¢«ä¿¡å·ä¸­æ–­
    return -EINTR;
}
// ä¸´ç•ŒåŒºä»£ç 
// ...
mutex_unlock(&my_mutex);

// å°è¯•è·å–é”ï¼ˆéé˜»å¡ï¼‰
if (mutex_trylock(&my_mutex)) {
    // æˆåŠŸè·å–é”
    // ä¸´ç•ŒåŒºä»£ç 
    // ...
    mutex_unlock(&my_mutex);
}

// é™æ€å®šä¹‰å’Œåˆå§‹åŒ–
DEFINE_MUTEX(static_mutex);
mutex_lock(&static_mutex);
// ä¸´ç•ŒåŒºä»£ç 
// ...
mutex_unlock(&static_mutex);</code></pre>
                        </td>
                    </tr>
                    
                    <!-- è¯´æ˜ -->
                    <tr>
                        <td class="border border-gray-300 rounded-bl-lg">
                            <p class="font-semibold">è¯´æ˜:</p>
                            <p class="mt-2">POSIXäº’æ–¥é”æ˜¯ç”¨æˆ·ç©ºé—´æœ€åŸºæœ¬çš„äº’æ–¥åŒæ­¥åŸè¯­ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
                            <ul class="list-disc ml-6 mt-2 space-y-1">
                                <li>å…è®¸çº¿ç¨‹åœ¨è¯·æ±‚å·²è¢«é”å®šçš„äº’æ–¥é”æ—¶é˜»å¡</li>
                                <li>æ”¯æŒå¤šç§ç±»å‹:
                                    <ul class="list-disc ml-6 mt-1 space-y-1">
                                        <li><strong>æ™®é€šé”:</strong> é‡å¤é”å®šå¯¼è‡´æ­»é”</li>
                                        <li><strong>é€’å½’é”:</strong> å…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€é”</li>
                                        <li><strong>æ£€é”™é”:</strong> å¯¹é”™è¯¯ä½¿ç”¨è¿”å›é”™è¯¯ç è€Œä¸æ˜¯æœªå®šä¹‰è¡Œä¸º</li>
                                    </ul>
                                </li>
                                <li>å¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œé¿å…æ— é™æœŸç­‰å¾…</li>
                                <li>é€šå¸¸åŸºäºfutexç³»ç»Ÿè°ƒç”¨å®ç°ï¼Œç»“åˆç”¨æˆ·ç©ºé—´è‡ªæ—‹å’Œå†…æ ¸ç­‰å¾…</li>
                                <li>è½»é‡çº§ï¼Œé€‚åˆä¿æŠ¤å…±äº«æ•°æ®çš„è®¿é—®</li>
                            </ul>
                        </td>
                        <td class="border border-gray-300 rounded-br-lg">
                            <p class="font-semibold">è¯´æ˜:</p>
                            <p class="mt-2">å†…æ ¸äº’æ–¥é”æ˜¯ä¸€ç§ç¡çœ é”ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶ä¼šè®©å‡ºå¤„ç†å™¨ã€‚ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
                            <ul class="list-disc ml-6 mt-2 space-y-1">
                                <li>é€‚ç”¨äºå¯èƒ½é•¿æ—¶é—´æŒæœ‰çš„é”ï¼Œæˆ–è€…ä¸´ç•ŒåŒºä¸­éœ€è¦æ‰§è¡Œå¯èƒ½é˜»å¡çš„æ“ä½œ</li>
                                <li>æŒæœ‰mutexæ—¶å…è®¸ä¼‘çœ ï¼Œä½†ä¸åº”åœ¨ä¸­æ–­æˆ–åŸå­ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</li>
                                <li>ä¸æ”¯æŒé€’å½’é”å®šï¼ˆåŒä¸€çº¿ç¨‹ä¸èƒ½å¤šæ¬¡è·å–åŒä¸€é”ï¼‰</li>
                                <li>å®ç°æ›´å¤æ‚ä½†CPUä½¿ç”¨æ•ˆç‡æ›´é«˜ï¼Œå› ä¸ºç­‰å¾…çº¿ç¨‹ä¸ä¼šæ¶ˆè€—CPU</li>
                                <li>æ”¯æŒå¯ä¸­æ–­è·å–ï¼Œå…è®¸ç­‰å¾…è¢«ä¿¡å·ä¸­æ–­</li>
                                <li>æ²¡æœ‰è¶…æ—¶è·å–çš„ç›´æ¥APIï¼ˆå¯é€šè¿‡å…¶ä»–æœºåˆ¶å®ç°ï¼‰</li>
                            </ul>
                        </td>
                    </tr>
                </table>
                
                <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <p class="font-semibold text-blue-800">ä¸»è¦åŒºåˆ«:</p>
                    <ul class="list-disc ml-6 mt-2 text-blue-700 space-y-1">
                        <li>å†…æ ¸æ€mutexä¸æ”¯æŒé€’å½’é”ï¼Œç”¨æˆ·æ€pthread_mutexæ”¯æŒå¤šç§é”ç±»å‹</li>
                        <li>å†…æ ¸æ€mutexæä¾›å¯ä¸­æ–­çš„é”è·å–æœºåˆ¶ï¼Œæ›´é€‚åˆå†…æ ¸ç¯å¢ƒ</li>
                        <li>ç”¨æˆ·æ€mutexæä¾›è¶…æ—¶è·å–åŠŸèƒ½ï¼Œå†…æ ¸æ²¡æœ‰ç›´æ¥å¯¹åº”API</li>
                        <li>å†…æ ¸æ€mutexä¸èƒ½åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä½¿ç”¨ï¼Œè€Œç”¨æˆ·æ€æ²¡æœ‰è¿™ç§é™åˆ¶</li>
                        <li>ä¸¤è€…å®ç°æœºåˆ¶ä¸åŒï¼šç”¨æˆ·æ€é€šå¸¸åŸºäºfutexï¼Œå†…æ ¸æ€æœ‰ä¸“é—¨çš„è°ƒåº¦è€ƒé‡</li>
                    </ul>
                </div>
            </div>

            <!-- è¯»å†™é” -->
            <div id="rwlock" class="section-container bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 pb-2 border-b border-gray-200 flex items-center">
                    <span class="mr-2 text-green-600">ğŸ“–</span> è¯»å†™é” (RW Lock)
                </h2>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mb-6">
                    <p class="font-medium">è¯»å†™é”å…è®¸å¤šä¸ªè¯»æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œä½†å†™æ“ä½œéœ€è¦ç‹¬å è®¿é—®ã€‚é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚</p>
                </div>
                
                <table class="comparison-table w-full border-collapse mb-4">
                    <tr class="bg-gray-100 rounded-t-lg">
                        <th class="border border-gray-300 rounded-tl-lg text-center w-1/2">ç”¨æˆ·æ€ (User Space)</th>
                        <th class="border border-gray-300 rounded-tr-lg text-center w-1/2">å†…æ ¸æ€ (Kernel Space)</th>
                    </tr>
                    
                    <!-- å¤´æ–‡ä»¶ -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å¤´æ–‡ä»¶:</p>
                            <code class="block my-2">#include &lt;pthread.h&gt;</code>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å¤´æ–‡ä»¶:</p>
                            <code class="block my-2">#include &lt;linux/rwlock.h&gt;</code> (è‡ªæ—‹è¯»å†™é”)<br>
                            <code class="block my-2">#include &lt;linux/rwsem.h&gt;</code> (è¯»å†™ä¿¡å·é‡)
                        </td>
                    </tr>
                    
                    <!-- ä¸»è¦API -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">ä¸»è¦API:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>pthread_rwlock_init()</code></li>
                                    <li><code>pthread_rwlock_destroy()</code></li>
                                    <li><code>pthread_rwlock_rdlock()</code></li>
                                    <li><code>pthread_rwlock_tryrdlock()</code></li>
                                    <li><code>pthread_rwlock_wrlock()</code></li>
                                    <li><code>pthread_rwlock_trywrlock()</code></li>
                                    <li><code>pthread_rwlock_unlock()</code></li>
                                    <li><code>pthread_rwlock_timedrdlock()</code></li>
                                    <li><code>pthread_rwlock_timedwrlock()</code></li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">è¯»å†™é”å±æ€§:</p>
                            <div class="mt-2">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>pthread_rwlockattr_init()</code></li>
                                    <li><code>pthread_rwlockattr_destroy()</code></li>
                                    <li><code>pthread_rwlockattr_setkind_np()</code> (GNUæ‰©å±•)</li>
                                </ul>
                            </div>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">è‡ªæ—‹è¯»å†™é”ä¸»è¦API:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>DEFINE_RWLOCK(name)</code></li>
                                    <li><code>rwlock_init()</code></li>
                                    <li><code>read_lock()</code></li>
                                    <li><code>read_unlock()</code></li>
                                    <li><code>write_lock()</code></li>
                                    <li><code>write_unlock()</code></li>
                                    <li><code>read_trylock()</code></li>
                                    <li><code>write_trylock()</code></li>
                                    <li><code>read_lock_irq()</code></li>
                                    <li><code>write_lock_irq()</code></li>
                                    <li><code>read_lock_irqsave()</code></li>
                                    <li><code>write_lock_irqsave()</code></li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">è¯»å†™ä¿¡å·é‡ä¸»è¦API:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>DECLARE_RWSEM(name)</code></li>
                                    <li><code>init_rwsem()</code></li>
                                    <li><code>down_read()</code></li>
                                    <li><code>down_read_trylock()</code></li>
                                    <li><code>up_read()</code></li>
                                    <li><code>down_write()</code></li>
                                    <li><code>down_write_trylock()</code></li>
                                    <li><code>up_write()</code></li>
                                    <li><code>downgrade_write()</code></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- ä½¿ç”¨ç¤ºä¾‹ -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">ä½¿ç”¨ç¤ºä¾‹:</p>
                            <pre><code>// å®šä¹‰è¯»å†™é”
pthread_rwlock_t rwlock;

// åˆå§‹åŒ–é»˜è®¤è¯»å†™é”
pthread_rwlock_init(&rwlock, NULL);

// è¯»é”ä½¿ç”¨
pthread_rwlock_rdlock(&rwlock);
// è¯»å–æ“ä½œ
// ...
pthread_rwlock_unlock(&rwlock);

// å†™é”ä½¿ç”¨
pthread_rwlock_wrlock(&rwlock);
// å†™å…¥æ“ä½œ
// ...
pthread_rwlock_unlock(&rwlock);

// å°è¯•è·å–è¯»é”ï¼ˆéé˜»å¡ï¼‰
if (pthread_rwlock_tryrdlock(&rwlock) == 0) {
    // æˆåŠŸè·å–è¯»é”
    // è¯»å–æ“ä½œ
    // ...
    pthread_rwlock_unlock(&rwlock);
}

// å¸¦è¶…æ—¶çš„ç­‰å¾…
struct timespec ts;
clock_gettime(CLOCK_REALTIME, &ts);
ts.tv_sec += 2;  // 2ç§’è¶…æ—¶
if (pthread_rwlock_timedrdlock(&rwlock, &ts) == 0) {
    // æˆåŠŸè·å–è¯»é”
    // ...
    pthread_rwlock_unlock(&rwlock);
}

// é…ç½®å†™è€…ä¼˜å…ˆçš„è¯»å†™é” (GNUæ‰©å±•)
pthread_rwlockattr_t attr;
pthread_rwlock_t pref_rwlock;

pthread_rwlockattr_init(&attr);
pthread_rwlockattr_setkind_np(&attr, 
    PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP);
pthread_rwlock_init(&pref_rwlock, &attr);
pthread_rwlockattr_destroy(&attr);</code></pre>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">è‡ªæ—‹è¯»å†™é”ä½¿ç”¨ç¤ºä¾‹:</p>
                            <pre><code>// å®šä¹‰è¯»å†™è‡ªæ—‹é”
rwlock_t my_rwlock;

// åˆå§‹åŒ–
rwlock_init(&my_rwlock);

// è¯»é”ä½¿ç”¨
read_lock(&my_rwlock);
// è¯»å–æ“ä½œ
// ...
read_unlock(&my_rwlock);

// å†™é”ä½¿ç”¨
write_lock(&my_rwlock);
// å†™å…¥æ“ä½œ
// ...
write_unlock(&my_rwlock);

// ä¿å­˜ä¸­æ–­çŠ¶æ€çš„ä½¿ç”¨
unsigned long flags;
write_lock_irqsave(&my_rwlock, flags);
// å†™å…¥æ“ä½œ
// ...
write_unlock_irqrestore(&my_rwlock, flags);</code></pre>

                            <p class="font-semibold mt-3">è¯»å†™ä¿¡å·é‡ä½¿ç”¨ç¤ºä¾‹:</p>
                            <pre><code>// å£°æ˜è¯»å†™ä¿¡å·é‡
struct rw_semaphore my_rwsem;

// åˆå§‹åŒ–
init_rwsem(&my_rwsem);

// è¯»é”ä½¿ç”¨
down_read(&my_rwsem);
// è¯»å–æ“ä½œ (å¯ä»¥ä¼‘çœ )
// ...
up_read(&my_rwsem);

// å†™é”ä½¿ç”¨
down_write(&my_rwsem);
// å†™å…¥æ“ä½œ (å¯ä»¥ä¼‘çœ )
// ...
up_write(&my_rwsem);

// å†™é”é™çº§
down_write(&my_rwsem);
// å†™å…¥æ“ä½œ
// ...
// å°†å†™é”é™çº§ä¸ºè¯»é”
downgrade_write(&my_rwsem);
// ç°åœ¨åªæŒæœ‰è¯»é”
// ...
up_read(&my_rwsem);</code></pre>
                        </td>
                    </tr>
                    
                    <!-- è¯´æ˜ -->
                    <tr>
                        <td class="border border-gray-300 rounded-bl-lg">
                            <p class="font-semibold">è¯´æ˜:</p>
                            <p class="mt-2">POSIXè¯»å†™é”å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å–å…±äº«èµ„æºï¼Œæˆ–å•ä¸ªçº¿ç¨‹ç‹¬å å†™å…¥ã€‚ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
                            <ul class="list-disc ml-6 mt-2 space-y-1">
                                <li>é€‚åˆè¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œå¯ä»¥æé«˜å¹¶å‘æ€§èƒ½</li>
                                <li>å†™é”å…·æœ‰æ’ä»–æ€§ï¼Œè¯»é”å…è®¸å…±äº«</li>
                                <li>é»˜è®¤å®ç°é€šå¸¸æ˜¯è¯»è€…ä¼˜å…ˆï¼Œä½†GNUæ‰©å±•å…è®¸é…ç½®åå¥½</li>
                                <li>å¯ä»¥è®¾ç½®è¶…æ—¶ï¼Œé¿å…æ— é™æœŸç­‰å¾…</li>
                                <li>ä¸æ”¯æŒå‡çº§ï¼ˆä»è¯»é”å‡çº§åˆ°å†™é”ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ­»é”</li>
                                <li>é€šå¸¸åŸºäºfutexç³»ç»Ÿè°ƒç”¨å®ç°</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">è¯»å†™é”ç­–ç•¥:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li><strong>è¯»è€…ä¼˜å…ˆ:</strong> åªè¦æœ‰æ´»è·ƒçš„è¯»è€…ï¼Œå†™è€…å¿…é¡»ç­‰å¾…</li>
                                <li><strong>å†™è€…ä¼˜å…ˆ:</strong> æ–°çš„è¯»è€…å¿…é¡»ç­‰å¾…å·²ç»ç­‰å¾…çš„å†™è€…</li>
                                <li><strong>å…¬å¹³ç­–ç•¥:</strong> æŒ‰è¯·æ±‚é¡ºåºå¤„ç†è¯»è€…å’Œå†™è€…</li>
                            </ul>
                        </td>
                        <td class="border border-gray-300 rounded-br-lg">
                            <p class="font-semibold">è¯´æ˜:</p>
                            <p class="mt-2">å†…æ ¸æä¾›ä¸¤ç§è¯»å†™é”:</p>
                            
                            <p class="mt-2 font-medium">è¯»å†™è‡ªæ—‹é” (rwlock_t):</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li>è‡ªæ—‹ç­‰å¾…å‹è¯»å†™é”ï¼Œä¸ä¼šå¼•èµ·çº¿ç¨‹ç¡çœ </li>
                                <li>å…è®¸å¤šä¸ªè¯»è€…åŒæ—¶æŒæœ‰è¯»é”ï¼Œæˆ–å•ä¸€å†™è€…æŒæœ‰å†™é”</li>
                                <li>é€‚ç”¨äºçŸ­å°ä¸´ç•ŒåŒºï¼Œé€šå¸¸ç”¨äºä¿æŠ¤é¢‘ç¹è®¿é—®ä½†å¾ˆå°‘ä¿®æ”¹çš„æ•°æ®</li>
                                <li>å†™è€…ä¼˜å…ˆï¼šå½“æœ‰å†™è€…åœ¨ç­‰å¾…æ—¶ï¼Œæ–°çš„è¯»è€…ä¸èƒ½è·å–é”</li>
                                <li>æŒæœ‰é”æœŸé—´ä¸å…è®¸ä¼‘çœ </li>
                                <li>æœ‰ä¸“é—¨çš„ä¸­æ–­ä¿æŠ¤å˜ä½“ï¼ˆå¦‚read_lock_irqsaveï¼‰</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">è¯»å†™ä¿¡å·é‡ (rw_semaphore):</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li>ç¡çœ å‹è¯»å†™é”ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè®©å‡ºå¤„ç†å™¨</li>
                                <li>é€‚ç”¨äºå¯èƒ½é•¿æ—¶é—´æŒæœ‰çš„é”ï¼Œæˆ–éœ€è¦æ‰§è¡Œå¯èƒ½é˜»å¡çš„æ“ä½œ</li>
                                <li>å¯ä»¥åœ¨æŒæœ‰é”æœŸé—´ä¼‘çœ ï¼Œä½†ä¸èƒ½åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</li>
                                <li>æ”¯æŒå°†å†™é”é™çº§ä¸ºè¯»é”ï¼Œä½†ä¸æ”¯æŒå°†è¯»é”å‡çº§ä¸ºå†™é”</li>
                                <li>æ²¡æœ‰ä¸­æ–­ä¸Šä¸‹æ–‡ç‰¹æ®Šå˜ä½“ï¼Œå› ä¸ºä¸èƒ½åœ¨ä¸­æ–­ä¸Šä¸‹æ–‡ä½¿ç”¨</li>
                            </ul>
                        </td>
                    </tr>
                </table>
                
                <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <p class="font-semibold text-blue-800">ä¸»è¦åŒºåˆ«:</p>
                    <ul class="list-disc ml-6 mt-2 text-blue-700 space-y-1">
                        <li>å†…æ ¸æä¾›ä¸¤ç§ä¸åŒçš„è¯»å†™é”å®ç°ï¼šè‡ªæ—‹å‹å’Œç¡çœ å‹ï¼Œè€Œç”¨æˆ·æ€åªæœ‰ä¸€ç§å®ç°</li>
                        <li>å†…æ ¸è¯»å†™é”æœ‰ä¸“é—¨çš„ä¸­æ–­ä¿æŠ¤å˜ä½“ï¼ˆå¦‚read_lock_irqsaveï¼‰</li>
                        <li>å†…æ ¸è¯»å†™ä¿¡å·é‡æä¾›æ˜¾å¼çš„å†™é”é™çº§APIï¼Œç”¨æˆ·æ€æ— æ­¤åŠŸèƒ½</li>
                        <li>ç”¨æˆ·æ€è¯»å†™é”æä¾›è¶…æ—¶è·å–åŠŸèƒ½ï¼Œå†…æ ¸APIæ²¡æœ‰ç›´æ¥å¯¹åº”åŠŸèƒ½</li>
                        <li>å†…æ ¸è‡ªæ—‹è¯»å†™é”åœ¨æŒæœ‰æœŸé—´ä¸å…è®¸ä¼‘çœ ï¼Œè€Œç”¨æˆ·æ€æ²¡æœ‰è¿™ç§é™åˆ¶</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
<script>window.parent.postMessage({ action: "ready" }, "*"); 
 
window.console = new Proxy(console, {
  get(target, prop) {
    if (['log', 'warn', 'error'].includes(prop)) {
      return new Proxy(target[prop], {
        apply(fn, thisArg, args) {
          fn.apply(thisArg, args);
          window.parent.postMessage({ action: 'console', 
            type: prop, 
            args: args.map((arg) => {
              try {
                return JSON.stringify(arg).replace(/^["']|["']$/g, '');
              } catch (e) {
                return arg;
              }
            }) 
          }, '*');
        }
      });
    }
    return target[prop];
  }
});
</script></body>
</html>