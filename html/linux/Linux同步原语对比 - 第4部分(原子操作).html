<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinuxåŒæ­¥åŸè¯­å¯¹æ¯”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        
        .sidebar {
            position: fixed;
            width: 240px;
            height: 100vh;
            overflow-y: auto;
            scrollbar-width: thin;
            background-color: #2d3748;
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 3px;
        }
        
        .nav-link {
            display: block;
            padding: 0.75rem 1rem;
            color: #e2e8f0;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background-color: #4a5568;
            border-left-color: #63b3ed;
        }
        
        .nav-link.active {
            background-color: #4a5568;
            border-left-color: #4299e1;
            font-weight: 600;
        }
        
        .main-content {
            margin-left: 240px;
            padding: 1.5rem;
        }
        
        .comparison-table th {
            padding: 0.75rem;
            font-weight: 600;
        }
        
        .comparison-table td {
            padding: 1rem 0.75rem;
            vertical-align: top;
        }
        
        .section-container {
            transition: transform 0.2s;
        }
        
        .section-container:hover {
            transform: translateY(-2px);
        }
        
        code {
            font-family: 'Cascadia Code', 'Source Code Pro', monospace;
            background-color: #edf2f7;
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
            font-size: 0.9em;
            color: #2c5282;
        }
        
        pre {
            background-color: #f8fafc;
            border-radius: 0.375rem;
            padding: 1rem;
            overflow-x: auto;
            border: 1px solid #e2e8f0;
            margin: 0.5rem 0;
        }
        
        pre code {
            background-color: transparent;
            padding: 0;
            color: #1a202c;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .api-list {
            column-count: 1;
        }
        
        @media (min-width: 1024px) {
            .api-list {
                column-count: 2;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- å›ºå®šåœ¨å·¦ä¾§çš„å¯¼èˆªæ  -->
    <aside class="sidebar">
        <div class="p-4 border-b border-gray-700">
            <h1 class="text-xl font-bold text-white">LinuxåŒæ­¥åŸè¯­å¯¹æ¯”</h1>
            <p class="text-sm text-gray-400 mt-1">ç”¨æˆ·æ€ä¸å†…æ ¸æ€</p>
        </div>
        <nav class="pt-2">
            <a href="#mutex" class="nav-link">
                <span class="mr-2">ğŸ”’</span> äº’æ–¥é” (Mutex)
            </a>
            <a href="#rwlock" class="nav-link">
                <span class="mr-2">ğŸ“–</span> è¯»å†™é” (RW Lock)
            </a>
            <a href="#spinlock" class="nav-link">
                <span class="mr-2">ğŸ”„</span> è‡ªæ—‹é” (Spinlock)
            </a>
            <a href="#semaphore" class="nav-link">
                <span class="mr-2">ğŸš¦</span> ä¿¡å·é‡ (Semaphore)
            </a>
            <a href="#seqlock" class="nav-link">
                <span class="mr-2">ğŸ“‘</span> é¡ºåºé” (SeqLock)
            </a>
            <a href="#rcu" class="nav-link">
                <span class="mr-2">ğŸ”„</span> RCU
            </a>
            <a href="#atomic" class="nav-link active">
                <span class="mr-2">âš›ï¸</span> åŸå­æ“ä½œ (Atomic)
            </a>
            <a href="#futex" class="nav-link">
                <span class="mr-2">â±ï¸</span> Futex
            </a>
            <div class="mt-4 p-4 bg-gray-800 text-xs text-gray-400">
                <p class="font-semibold text-gray-300 mb-1">å¯¼èˆªè¯´æ˜</p>
                <p>ç‚¹å‡»é“¾æ¥å¯ç›´æ¥è·³è½¬åˆ°å¯¹åº”çš„åŒæ­¥åŸè¯­è¯¦æƒ…ã€‚</p>
            </div>
        </nav>
    </aside>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content pb-12">
        <div class="max-w-6xl mx-auto">
            <!-- åŸå­æ“ä½œ -->
            <div id="atomic" class="section-container bg-white rounded-lg shadow-md p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 pb-2 border-b border-gray-200 flex items-center">
                    <span class="mr-2 text-purple-600">âš›ï¸</span> åŸå­æ“ä½œ (Atomic Operations)
                </h2>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mb-6">
                    <p class="font-medium">åŸå­æ“ä½œæ˜¯ä¸å¯ä¸­æ–­çš„åŸºæœ¬æ“ä½œï¼Œä¿è¯åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šä¹Ÿèƒ½ä»¥åŸå­æ–¹å¼æ‰§è¡Œï¼Œæ— éœ€é¢å¤–çš„é”ä¿æŠ¤ã€‚</p>
                </div>
                
                <table class="comparison-table w-full border-collapse mb-4">
                    <tr class="bg-gray-100 rounded-t-lg">
                        <th class="border border-gray-300 rounded-tl-lg text-center w-1/2">ç”¨æˆ·æ€ (User Space)</th>
                        <th class="border border-gray-300 rounded-tr-lg text-center w-1/2">å†…æ ¸æ€ (Kernel Space)</th>
                    </tr>
                    
                    <!-- å¤´æ–‡ä»¶ -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å¤´æ–‡ä»¶:</p>
                            <p class="mt-2">POSIX/GNUåŸå­æ“ä½œ:</p>
                            <code class="block my-1">#include &lt;stdatomic.h&gt;</code>
                            
                            <p class="mt-2">GNUæ‰©å±•:</p>
                            <code class="block my-1">#include &lt;atomic.h&gt;</code>
                            
                            <p class="mt-2">GCCå†…ç½®åŸå­å‡½æ•°:</p>
                            <p class="mt-1 text-sm text-gray-600">æ— éœ€ç‰¹æ®Šå¤´æ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨<code>__atomic_*</code>å†…ç½®å‡½æ•°ã€‚</p>
                            
                            <p class="mt-2">C++11åŠæ›´é«˜ç‰ˆæœ¬:</p>
                            <code class="block my-1">#include &lt;atomic&gt;</code>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å¤´æ–‡ä»¶:</p>
                            <code class="block my-2">#include &lt;linux/atomic.h&gt;</code>
                            
                            <p class="mt-2">ç‰¹å®šç±»å‹åŸå­æ“ä½œ:</p>
                            <code class="block my-1">#include &lt;linux/atomic-instrumented.h&gt;</code>
                            <code class="block my-1">#include &lt;linux/atomic-fallback.h&gt;</code>
                            <code class="block my-1">#include &lt;linux/atomic-arch-fallback.h&gt;</code>
                            
                            <p class="mt-2">å†…å­˜å±éšœï¼ˆä¸åŸå­æ“ä½œç›¸å…³ï¼‰:</p>
                            <code class="block my-1">#include &lt;linux/compiler.h&gt;</code>
                            <code class="block my-1">#include &lt;asm/barrier.h&gt;</code>
                        </td>
                    </tr>
                    
                    <!-- ä¸»è¦API -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">C11 æ ‡å‡† (stdatomic.h):</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>atomic_store()</code> - åŸå­å­˜å‚¨å€¼</li>
                                    <li><code>atomic_load()</code> - åŸå­è¯»å–å€¼</li>
                                    <li><code>atomic_exchange()</code> - åŸå­äº¤æ¢å€¼</li>
                                    <li><code>atomic_compare_exchange_weak()</code></li>
                                    <li><code>atomic_compare_exchange_strong()</code></li>
                                    <li><code>atomic_fetch_add()</code> - åŸå­åŠ æ³•</li>
                                    <li><code>atomic_fetch_sub()</code> - åŸå­å‡æ³•</li>
                                    <li><code>atomic_fetch_or()</code> - åŸå­æŒ‰ä½æˆ–</li>
                                    <li><code>atomic_fetch_xor()</code> - åŸå­æŒ‰ä½å¼‚æˆ–</li>
                                    <li><code>atomic_fetch_and()</code> - åŸå­æŒ‰ä½ä¸</li>
                                    <li><code>atomic_flag_test_and_set()</code></li>
                                    <li><code>atomic_flag_clear()</code></li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">GCCå†…ç½®å‡½æ•°:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>__atomic_load_n()</code> - åŠ è½½å€¼</li>
                                    <li><code>__atomic_store_n()</code> - å­˜å‚¨å€¼</li>
                                    <li><code>__atomic_exchange_n()</code> - äº¤æ¢å€¼</li>
                                    <li><code>__atomic_compare_exchange_n()</code></li>
                                    <li><code>__atomic_add_fetch()</code> - åŠ æ³•åè¿”å›</li>
                                    <li><code>__atomic_sub_fetch()</code> - å‡æ³•åè¿”å›</li>
                                    <li><code>__atomic_fetch_add()</code> - åŠ æ³•å‰è¿”å›</li>
                                    <li><code>__atomic_fetch_sub()</code> - å‡æ³•å‰è¿”å›</li>
                                    <li><code>__atomic_fetch_and()</code> - æŒ‰ä½ä¸</li>
                                    <li><code>__atomic_fetch_or()</code> - æŒ‰ä½æˆ–</li>
                                    <li><code>__atomic_fetch_xor()</code> - æŒ‰ä½å¼‚æˆ–</li>
                                    <li><code>__atomic_test_and_set()</code></li>
                                    <li><code>__atomic_clear()</code></li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">C++11 (atomic):</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>std::atomic&lt;T&gt;</code> - åŸå­ç±»å‹æ¨¡æ¿</li>
                                    <li><code>store()</code> - åŸå­å­˜å‚¨</li>
                                    <li><code>load()</code> - åŸå­åŠ è½½</li>
                                    <li><code>exchange()</code> - åŸå­äº¤æ¢</li>
                                    <li><code>compare_exchange_weak()</code></li>
                                    <li><code>compare_exchange_strong()</code></li>
                                    <li><code>fetch_add()</code> - åŸå­åŠ æ³•</li>
                                    <li><code>fetch_sub()</code> - åŸå­å‡æ³•</li>
                                    <li><code>fetch_and()</code> - åŸå­æŒ‰ä½ä¸</li>
                                    <li><code>fetch_or()</code> - åŸå­æŒ‰ä½æˆ–</li>
                                    <li><code>fetch_xor()</code> - åŸå­æŒ‰ä½å¼‚æˆ–</li>
                                    <li><code>operator++, operator--</code> - é‡è½½è¿ç®—ç¬¦</li>
                                    <li><code>std::atomic_flag</code> - ç‰¹æ®ŠåŸå­å¸ƒå°”ç±»å‹</li>
                                    <li><code>std::memory_order</code> - å†…å­˜åºæšä¸¾</li>
                                </ul>
                            </div>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">æ•´æ•°åŸå­æ“ä½œ:</p>
                            <div class="mt-2 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>atomic_read()</code> - è¯»å–å€¼</li>
                                    <li><code>atomic_set()</code> - è®¾ç½®å€¼</li>
                                    <li><code>atomic_add()</code> - åŸå­åŠ æ³•</li>
                                    <li><code>atomic_sub()</code> - åŸå­å‡æ³•</li>
                                    <li><code>atomic_inc()</code> - åŸå­å¢åŠ 1</li>
                                    <li><code>atomic_dec()</code> - åŸå­å‡å°‘1</li>
                                    <li><code>atomic_add_return()</code> - åŠ æ³•åè¿”å›</li>
                                    <li><code>atomic_sub_return()</code> - å‡æ³•åè¿”å›</li>
                                    <li><code>atomic_inc_return()</code> - å¢åŠ 1åè¿”å›</li>
                                    <li><code>atomic_dec_return()</code> - å‡å°‘1åè¿”å›</li>
                                    <li><code>atomic_fetch_add()</code> - åŠ æ³•å‰è¿”å›</li>
                                    <li><code>atomic_fetch_sub()</code> - å‡æ³•å‰è¿”å›</li>
                                    <li><code>atomic_fetch_inc()</code> - å¢åŠ 1å‰è¿”å›</li>
                                    <li><code>atomic_fetch_dec()</code> - å‡å°‘1å‰è¿”å›</li>
                                    <li><code>atomic_inc_and_test()</code> - å¢åŠ å¹¶æµ‹è¯•</li>
                                    <li><code>atomic_dec_and_test()</code> - å‡å°‘å¹¶æµ‹è¯•</li>
                                    <li><code>atomic_sub_and_test()</code> - å‡æ³•å¹¶æµ‹è¯•</li>
                                    <li><code>atomic_add_negative()</code> - åŠ æ³•åæµ‹è´Ÿ</li>
                                    <li><code>atomic_fetch_or()</code> - æŒ‰ä½æˆ–</li>
                                    <li><code>atomic_fetch_and()</code> - æŒ‰ä½ä¸</li>
                                    <li><code>atomic_fetch_xor()</code> - æŒ‰ä½å¼‚æˆ–</li>
                                    <li><code>atomic_xchg()</code> - åŸå­äº¤æ¢</li>
                                    <li><code>atomic_cmpxchg()</code> - æ¯”è¾ƒå¹¶äº¤æ¢</li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">ä½æ“ä½œ:</p>
                            <div class="mt-1 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>set_bit()</code> - è®¾ç½®æŒ‡å®šä½</li>
                                    <li><code>clear_bit()</code> - æ¸…é™¤æŒ‡å®šä½</li>
                                    <li><code>change_bit()</code> - ç¿»è½¬æŒ‡å®šä½</li>
                                    <li><code>test_and_set_bit()</code> - æµ‹è¯•å¹¶è®¾ç½®ä½</li>
                                    <li><code>test_and_clear_bit()</code> - æµ‹è¯•å¹¶æ¸…é™¤ä½</li>
                                    <li><code>test_and_change_bit()</code> - æµ‹è¯•å¹¶ç¿»è½¬ä½</li>
                                    <li><code>test_bit()</code> - æµ‹è¯•æŒ‡å®šä½</li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">64ä½åŸå­æ“ä½œ:</p>
                            <div class="mt-1 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>atomic64_read()</code> - è¯»å–64ä½å€¼</li>
                                    <li><code>atomic64_set()</code> - è®¾ç½®64ä½å€¼</li>
                                    <li><code>atomic64_add()</code> - 64ä½åŸå­åŠ æ³•</li>
                                    <li><code>atomic64_sub()</code> - 64ä½åŸå­å‡æ³•</li>
                                    <li><code>atomic64_inc()</code> - 64ä½åŸå­å¢åŠ 1</li>
                                    <li><code>atomic64_dec()</code> - 64ä½åŸå­å‡å°‘1</li>
                                    <li><code>atomic64_add_return()</code></li>
                                    <li><code>atomic64_fetch_add()</code></li>
                                    <li>... ç±»ä¼¼32ä½æ“ä½œçš„64ä½ç‰ˆæœ¬</li>
                                </ul>
                            </div>
                            
                            <p class="font-semibold mt-3">å†…å­˜å±éšœ:</p>
                            <div class="mt-1 api-list">
                                <ul class="list-disc ml-6 space-y-1">
                                    <li><code>mb()</code> - å®Œå…¨å†…å­˜å±éšœ</li>
                                    <li><code>rmb()</code> - è¯»å†…å­˜å±éšœ</li>
                                    <li><code>wmb()</code> - å†™å†…å­˜å±éšœ</li>
                                    <li><code>smp_mb()</code> - SMPå®Œå…¨å†…å­˜å±éšœ</li>
                                    <li><code>smp_rmb()</code> - SMPè¯»å†…å­˜å±éšœ</li>
                                    <li><code>smp_wmb()</code> - SMPå†™å†…å­˜å±éšœ</li>
                                    <li><code>barrier()</code> - ç¼–è¯‘å™¨å±éšœ</li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    
                    <!-- ä½¿ç”¨ç¤ºä¾‹ -->
                    <tr>
                        <td class="border border-gray-300">
                            <p class="font-semibold">C11 stdatomic.h ç¤ºä¾‹:</p>
                            <pre><code>#include &lt;stdatomic.h&gt;
#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;

// å®šä¹‰åŸå­å˜é‡
atomic_int counter = 0;

void* increment_thread(void* arg) {
    for (int i = 0; i < 10000; i++) {
        // åŸå­åŠ æ³•æ“ä½œ
        atomic_fetch_add(&counter, 1);
    }
    return NULL;
}

int main() {
    pthread_t t1, t2;
    
    // åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€’å¢è®¡æ•°å™¨
    pthread_create(&t1, NULL, increment_thread, NULL);
    pthread_create(&t2, NULL, increment_thread, NULL);
    
    pthread_join(t1, NULL);
    pthread_join(t2, NULL);
    
    // è¯»å–æœ€ç»ˆè®¡æ•°å™¨å€¼
    printf("Final counter value: %d\n", atomic_load(&counter));
    
    // åº”è¯¥è¾“å‡º 20000
    return 0;
}</code></pre>
                            
                            <p class="mt-3 text-sm text-gray-700">C++11 atomic ç¤ºä¾‹:</p>
                            <pre><code>#include &lt;atomic&gt;
#include &lt;thread&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;

// åŸå­è®¡æ•°å™¨
std::atomic&lt;int&gt; counter(0);
// åŸå­æ ‡å¿—
std::atomic_flag lock = ATOMIC_FLAG_INIT;

void increment_counter() {
    for (int i = 0; i < 1000; ++i) {
        // åŸå­é€’å¢
        counter.fetch_add(1, std::memory_order_relaxed);
    }
}

void spinlock_example() {
    // ä½¿ç”¨åŸå­æ ‡å¿—å®ç°è‡ªæ—‹é”
    while (lock.test_and_set(std::memory_order_acquire)) {
        // è‡ªæ—‹ç­‰å¾…
    }
    
    // ä¸´ç•ŒåŒºä»£ç 
    std::cout << "Thread " << std::this_thread::get_id() 
              << " in critical section" << std::endl;
    
    // é‡Šæ”¾é”
    lock.clear(std::memory_order_release);
}

int main() {
    std::vector&lt;std::thread&gt; threads;
    
    // åˆ›å»º10ä¸ªçº¿ç¨‹é€’å¢è®¡æ•°å™¨
    for (int i = 0; i < 10; ++i) {
        threads.push_back(std::thread(increment_counter));
    }
    
    // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
    for (auto& t : threads) {
        t.join();
    }
    
    std::cout << "Final counter value: " << counter << std::endl;
    // åº”è¯¥è¾“å‡º 10000
    
    // æµ‹è¯•è‡ªæ—‹é”
    std::thread t1(spinlock_example);
    std::thread t2(spinlock_example);
    t1.join();
    t2.join();
    
    return 0;
}</code></pre>
                            
                            <p class="mt-3 text-sm text-gray-700">GCC å†…ç½®åŸå­å‡½æ•°ç¤ºä¾‹:</p>
                            <pre><code>#include &lt;stdio.h&gt;
#include &lt;pthread.h&gt;

// åŸå­å˜é‡
int atomic_var = 0;

void* atomic_thread(void* arg) {
    for (int i = 0; i < 10000; i++) {
        // ä½¿ç”¨GCCå†…ç½®åŸå­å‡½æ•°
        __atomic_fetch_add(&atomic_var, 1, __ATOMIC_SEQ_CST);
    }
    return NULL;
}

int main() {
    pthread_t t1, t2;
    
    pthread_create(&t1, NULL, atomic_thread, NULL);
    pthread_create(&t2, NULL, atomic_thread, NULL);
    
    pthread_join(t1, NULL);
    pthread_join(t2, NULL);
    
    int result;
    __atomic_load(&atomic_var, &result, __ATOMIC_SEQ_CST);
    printf("Final value: %d\n", result);
    
    // æ¯”è¾ƒå¹¶äº¤æ¢ç¤ºä¾‹
    int expected = result;
    int desired = 0;
    if (__atomic_compare_exchange_n(
            &atomic_var, &expected, desired, 
            0, __ATOMIC_SEQ_CST, __ATOMIC_SEQ_CST)) {
        printf("CAS success\n");
    } else {
        printf("CAS failed\n");
    }
    
    return 0;
}</code></pre>
                        </td>
                        <td class="border border-gray-300">
                            <p class="font-semibold">å†…æ ¸åŸå­æ“ä½œç¤ºä¾‹:</p>
                            <pre><code>// å®šä¹‰åŸå­å˜é‡
atomic_t my_counter = ATOMIC_INIT(0);
atomic64_t my_counter64 = ATOMIC64_INIT(0);

// åŸå­é€’å¢ç¤ºä¾‹
static void example_atomic_inc(void)
{
    // è¯»å–åŸå­å˜é‡
    int old_value = atomic_read(&my_counter);
    
    // åŸå­é€’å¢è®¡æ•°å™¨
    atomic_inc(&my_counter);
    
    // åŸå­é€’å¢å¹¶è¿”å›æ–°å€¼
    int new_value = atomic_inc_return(&my_counter);
    
    printk(KERN_INFO "Old: %d, New: %d\n", old_value, new_value);
    
    // åŸå­å‡å°‘è®¡æ•°å™¨å¹¶æµ‹è¯•æ˜¯å¦ä¸ºé›¶
    if (atomic_dec_and_test(&my_counter)) {
        printk(KERN_INFO "Counter reached zero\n");
    }
    
    // åŸå­åŠ æ³•
    atomic_add(10, &my_counter);
    
    // åŸå­å‡æ³•
    atomic_sub(5, &my_counter);
    
    // åŠ æ³•åè¿”å›æ–°å€¼
    int after_add = atomic_add_return(3, &my_counter);
    
    // å‡æ³•å‰è¿”å›æ—§å€¼
    int before_sub = atomic_fetch_sub(2, &my_counter);
    
    // æ¯”è¾ƒå¹¶äº¤æ¢
    int old = 5;
    if (atomic_cmpxchg(&my_counter, old, 6) == old) {
        printk(KERN_INFO "CAS success\n");
    } else {
        printk(KERN_INFO "CAS failed\n");
    }
}</code></pre>
                            
                            <p class="mt-3 text-sm text-gray-700">ä½æ“ä½œç¤ºä¾‹:</p>
                            <pre><code>// åŸå­ä½æ“ä½œç¤ºä¾‹
static void example_bit_operations(void)
{
    unsigned long flags = 0;
    
    // è®¾ç½®ç¬¬3ä½
    set_bit(3, &flags);
    
    // æ¸…é™¤ç¬¬2ä½
    clear_bit(2, &flags);
    
    // ç¿»è½¬ç¬¬1ä½
    change_bit(1, &flags);
    
    // æµ‹è¯•ç¬¬3ä½æ˜¯å¦è®¾ç½®
    if (test_bit(3, &flags)) {
        printk(KERN_INFO "Bit 3 is set\n");
    }
    
    // æµ‹è¯•å¹¶è®¾ç½®ç¬¬4ä½ï¼Œè¿”å›æ—§å€¼
    if (test_and_set_bit(4, &flags)) {
        printk(KERN_INFO "Bit 4 was already set\n");
    } else {
        printk(KERN_INFO "Bit 4 was cleared, now set\n");
    }
    
    // æµ‹è¯•å¹¶æ¸…é™¤ç¬¬3ä½ï¼Œè¿”å›æ—§å€¼
    if (test_and_clear_bit(3, &flags)) {
        printk(KERN_INFO "Bit 3 was set, now cleared\n");
    }
}</code></pre>
                            
                            <p class="mt-3 text-sm text-gray-700">64ä½åŸå­æ“ä½œå’Œå†…å­˜å±éšœç¤ºä¾‹:</p>
                            <pre><code>// 64ä½åŸå­æ“ä½œç¤ºä¾‹
static void example_atomic64_operations(void)
{
    // è®¾ç½®åˆå§‹å€¼
    atomic64_set(&my_counter64, 100);
    
    // åŸå­åŠ æ³•
    atomic64_add(50, &my_counter64);
    
    // è¯»å–å½“å‰å€¼
    long value = atomic64_read(&my_counter64);
    
    // å‡æ³•åè¿”å›
    long after_sub = atomic64_sub_return(20, &my_counter64);
    
    printk(KERN_INFO "Value: %ld, After sub: %ld\n", 
           value, after_sub);
}

// å†…å­˜å±éšœç¤ºä¾‹
static void example_memory_barriers(void)
{
    int value = 0;
    
    // å†™å…¥å˜é‡
    value = 100;
    
    // å†™å†…å­˜å±éšœï¼Œç¡®ä¿ä¹‹å‰çš„å†™å…¥å¯¹å…¶ä»–CPUå¯è§
    smp_wmb();
    
    // è®¾ç½®ä¸€ä¸ªæ ‡å¿—
    set_bit(0, &flags);
    
    // å®Œå…¨å†…å­˜å±éšœï¼Œç¡®ä¿ä¹‹å‰çš„å†™å…¥å¯¹å…¶ä»–CPUå¯è§
    // å¹¶ä¸”ä¹‹åçš„è¯»å–ä»å†…å­˜ä¸­è·å–æœ€æ–°å€¼
    smp_mb();
    
    // è¯»å–å…¶ä»–å˜é‡
    int other_value = atomic_read(&my_counter);
    
    // è¯»å†…å­˜å±éšœï¼Œç¡®ä¿ä¹‹åçš„è¯»å–ä»å†…å­˜ä¸­è·å–æœ€æ–°å€¼
    smp_rmb();
    
    // è¯»å–å¦ä¸€ä¸ªå˜é‡
    long value64 = atomic64_read(&my_counter64);
    
    // ç¼–è¯‘å™¨å±éšœï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’æŒ‡ä»¤
    barrier();
}</code></pre>
                        </td>
                    </tr>
                    
                    <!-- è¯´æ˜ -->
                    <tr>
                        <td class="border border-gray-300 rounded-bl-lg">
                            <p class="font-semibold">è¯´æ˜:</p>
                            <p class="mt-2">ç”¨æˆ·æ€æä¾›å¤šç§åŸå­æ“ä½œAPIï¼Œä»æ ‡å‡†C11/C++11åˆ°GCCç‰¹å®šæ‰©å±•ã€‚ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
                            <ul class="list-disc ml-6 mt-2 space-y-1">
                                <li>æä¾›ä¸å¯åˆ†å‰²çš„åŸºæœ¬æ“ä½œï¼Œåœ¨å¤šæ ¸ç¯å¢ƒä¸‹ä¿è¯åŸå­æ€§</li>
                                <li>æ— éœ€é¢å¤–çš„äº’æ–¥æœºåˆ¶ï¼Œç›´æ¥åŸºäºç¡¬ä»¶å®ç°ï¼Œæ€§èƒ½é«˜</li>
                                <li>C11/C++11æ ‡å‡†æä¾›äº†å¯ç§»æ¤çš„åŸå­æ“ä½œAPI</li>
                                <li>æ”¯æŒå¤šç§å†…å­˜åºå’Œå†…å­˜å±éšœæ¨¡å‹ï¼Œçµæ´»æ§åˆ¶æ“ä½œçš„å¯è§æ€§</li>
                                <li>C++11é¢å¤–æä¾›äº†åŸå­æ¨¡æ¿ç±»ï¼Œæ”¯æŒä»»æ„ç±»å‹çš„åŸå­æ“ä½œ</li>
                                <li>GCCå†…ç½®å‡½æ•°æä¾›äº†æ›´åº•å±‚å’Œçµæ´»çš„æ§åˆ¶</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">æ”¯æŒçš„å†…å­˜åºï¼ˆMemory Orderingï¼‰:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li><code>memory_order_relaxed</code>: æœ€ä½é™åˆ¶ï¼Œä»…ä¿è¯æ“ä½œåŸå­æ€§</li>
                                <li><code>memory_order_consume</code>: æ•°æ®ä¾èµ–åº</li>
                                <li><code>memory_order_acquire</code>: è·å–è¯­ä¹‰ï¼Œç”¨äºè¯»å–æ“ä½œ</li>
                                <li><code>memory_order_release</code>: é‡Šæ”¾è¯­ä¹‰ï¼Œç”¨äºå†™å…¥æ“ä½œ</li>
                                <li><code>memory_order_acq_rel</code>: è·å–-é‡Šæ”¾è¯­ä¹‰ï¼Œç”¨äºè¯»-æ”¹-å†™æ“ä½œ</li>
                                <li><code>memory_order_seq_cst</code>: é¡ºåºä¸€è‡´æ€§ï¼Œæœ€ä¸¥æ ¼ä½†å¼€é”€æœ€å¤§</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">ä¸»è¦åº”ç”¨åœºæ™¯:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li>æ— é”æ•°æ®ç»“æ„çš„å®ç°</li>
                                <li>é«˜å¹¶å‘è®¡æ•°å™¨</li>
                                <li>æ ‡å¿—ä½çš„åŸå­æ›´æ–°</li>
                                <li>è‡ªæ—‹é”å’Œå…¶ä»–åŒæ­¥åŸè¯­çš„åº•å±‚å®ç°</li>
                                <li>é«˜æ€§èƒ½å¹¶å‘ç®—æ³•</li>
                                <li>é¿å…äº’æ–¥é”çš„æ€§èƒ½å¼€é”€</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">é™åˆ¶:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li>åªé€‚ç”¨äºç®€å•æ•°æ®ç±»å‹æˆ–ç»“æ„</li>
                                <li>å¤æ‚æ“ä½œéœ€è¦ç»„åˆå¤šä¸ªåŸå­æ“ä½œï¼Œå®ç°éš¾åº¦é«˜</li>
                                <li>ä¸æ­£ç¡®ä½¿ç”¨å†…å­˜åºå¯èƒ½å¯¼è‡´éš¾ä»¥è°ƒè¯•çš„å¹¶å‘é”™è¯¯</li>
                                <li>ä¸åŒç¡¬ä»¶å¹³å°çš„æ€§èƒ½ç‰¹æ€§å¯èƒ½å·®å¼‚è¾ƒå¤§</li>
                                <li>å¤æ‚åŸå­æ“ä½œå¯èƒ½æ¯”ç®€å•çš„äº’æ–¥é”ä»£ç æ›´éš¾ç†è§£</li>
                            </ul>
                            
                            <p class="mt-3 p-3 bg-blue-50 rounded-md">
                                <span class="text-blue-800 font-medium">æœ€ä½³å®è·µ:</span> å¯¹äºç®€å•çš„åŸå­è®¡æ•°å™¨æˆ–æ ‡å¿—ä½ï¼ŒåŸå­æ“ä½œæ˜¯ç†æƒ³é€‰æ‹©ã€‚å¯¹äºå¤æ‚çš„æ•°æ®ç»“æ„æˆ–æ“ä½œï¼Œåº”è€ƒè™‘ä½¿ç”¨äº’æ–¥é”æˆ–æ›´é«˜çº§çš„åŒæ­¥æœºåˆ¶ã€‚é™¤éç¡®å®éœ€è¦æè‡´æ€§èƒ½å¹¶æ·±å…¥ç†è§£å†…å­˜æ¨¡å‹ï¼Œå¦åˆ™å°½é‡ä½¿ç”¨<code>memory_order_seq_cst</code>ä»¥ç¡®ä¿æ­£ç¡®æ€§ã€‚
                            </p>
                        </td>
                        <td class="border border-gray-300 rounded-br-lg">
                            <p class="font-semibold">è¯´æ˜:</p>
                            <p class="mt-2">å†…æ ¸åŸå­æ“ä½œæä¾›äº†ä¸å¯åˆ†å‰²çš„åŸºæœ¬æ“ä½œé›†ï¼Œæ˜¯å†…æ ¸åŒæ­¥åŸè¯­çš„åŸºç¡€ã€‚ä¸»è¦ç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
                            <ul class="list-disc ml-6 mt-2 space-y-1">
                                <li>åŸºäºåº•å±‚CPUæ¶æ„æŒ‡ä»¤å®ç°ï¼Œç¡¬ä»¶ä¿è¯æ“ä½œåŸå­æ€§</li>
                                <li>æä¾›é’ˆå¯¹æ•´æ•°å’Œä½æ“ä½œçš„å…¨é¢API</li>
                                <li>åŒºåˆ†32ä½å’Œ64ä½åŸå­æ“ä½œ</li>
                                <li>ä¸éœ€è¦è·å–é”ï¼Œé€‚åˆé«˜æ€§èƒ½åœºæ™¯</li>
                                <li>ç”¨äºå…¶ä»–åŒæ­¥åŸè¯­çš„åº•å±‚å®ç°</li>
                                <li>æ­é…å†…å­˜å±éšœä½¿ç”¨ï¼Œç¡®ä¿å¤šCPUç³»ç»Ÿçš„æ­£ç¡®æ€§</li>
                                <li>æ¶æ„æ— å…³APIåŠ ä¸Šæ¶æ„ç‰¹å®šä¼˜åŒ–å®ç°</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">åŸå­æ“ä½œç±»å‹:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li><code>atomic_t</code>: 32ä½åŸå­æ•´æ•°ç±»å‹</li>
                                <li><code>atomic64_t</code>: 64ä½åŸå­æ•´æ•°ç±»å‹</li>
                                <li>ä½æ“ä½œ: é’ˆå¯¹<code>unsigned long</code>çš„ä½çº§åŸå­æ“ä½œ</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">å†…å­˜å±éšœ:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li><code>mb()</code>: å®Œå…¨å†…å­˜å±éšœï¼Œç¡®ä¿å±éšœå‰åçš„æ‰€æœ‰è®¿é—®é¡ºåº</li>
                                <li><code>rmb()</code>: è¯»å†…å­˜å±éšœï¼Œç¡®ä¿å±éšœå‰åçš„è¯»å–é¡ºåº</li>
                                <li><code>wmb()</code>: å†™å†…å­˜å±éšœï¼Œç¡®ä¿å±éšœå‰åçš„å†™å…¥é¡ºåº</li>
                                <li><code>smp_*</code>ç³»åˆ—: ä»…åœ¨SMPç³»ç»Ÿä¸Šæœ‰æ•ˆçš„å±éšœ</li>
                                <li><code>barrier()</code>: ç¼–è¯‘å™¨å±éšœï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–é‡æ’æŒ‡ä»¤</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">ä¸»è¦åº”ç”¨åœºæ™¯:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li>å¼•ç”¨è®¡æ•°ï¼ˆå¦‚<code>refcount_t</code>ï¼‰</li>
                                <li>é”è®¡æ•°å™¨å’Œæ ‡å¿—ä½</li>
                                <li>å¹¶å‘è®¿é—®çš„è®¡æ•°å™¨å’Œç»Ÿè®¡æ•°æ®</li>
                                <li>è‡ªæ—‹é”ç­‰åŒæ­¥åŸè¯­çš„å®ç°</li>
                                <li>RCUå’Œé¡ºåºé”ç­‰é«˜çº§åŒæ­¥æœºåˆ¶çš„åŸºç¡€</li>
                                <li>æ— é”ç®—æ³•å’Œæ•°æ®ç»“æ„</li>
                                <li>è®¾å¤‡çŠ¶æ€å’Œæ ‡å¿—ç®¡ç†</li>
                            </ul>
                            
                            <p class="mt-2 font-medium">é™åˆ¶å’Œæ³¨æ„äº‹é¡¹:</p>
                            <ul class="list-disc ml-6 mt-1 space-y-1">
                                <li>åŸå­æ“ä½œçš„èŒƒå›´æœ‰é™ï¼Œ<code>atomic_t</code>é€šå¸¸é™äº24ä½ï¼ˆå–å†³äºæ¶æ„ï¼‰</li>
                                <li>å¤æ‚æ“ä½œéœ€è¦ç»“åˆå¤šä¸ªåŸå­æ“ä½œå’Œé€‚å½“çš„å†…å­˜å±éšœ</li>
                                <li>æ»¥ç”¨åŸå­æ“ä½œå¯èƒ½å¯¼è‡´ç¡¬ä»¶ç¼“å­˜ä¸€è‡´æ€§é£æš´ï¼Œå½±å“æ€§èƒ½</li>
                                <li>ä¸åŒæ¶æ„çš„åŸå­æ“ä½œå®ç°å’Œæ€§èƒ½ç‰¹æ€§ä¸åŒ</li>
                                <li>åŸå­æ“ä½œæœ¬èº«å¯èƒ½åŒ…å«éšå«çš„å†…å­˜å±éšœï¼Œå½±å“æ€§èƒ½</li>
                                <li>éœ€è¦ç†è§£SMPå†…å­˜æ¨¡å‹å’Œå†…å­˜å±éšœçš„æ­£ç¡®ä½¿ç”¨</li>
                            </ul>
                            
                            <p class="mt-3 p-3 bg-red-50 rounded-md">
                                <span class="text-red-800 font-medium">é‡è¦æç¤ºï¼š</span> å†…æ ¸åŸå­æ“ä½œæ˜¯åº•å±‚æœºåˆ¶ï¼Œæ­£ç¡®ä½¿ç”¨éœ€è¦æ·±å…¥ç†è§£CPUå†…å­˜æ¨¡å‹å’Œç¼“å­˜ä¸€è‡´æ€§ã€‚è™½ç„¶åŸå­æ“ä½œæœ¬èº«æ˜¯ç®€å•çš„ï¼Œä½†ç»„åˆä½¿ç”¨æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„å†…å­˜å±éšœçš„æ”¾ç½®ï¼Œä»¥ç¡®ä¿åœ¨å¤šCPUç³»ç»Ÿä¸Šçš„æ­£ç¡®è¡Œä¸ºã€‚å§‹ç»ˆä¼˜å…ˆä½¿ç”¨æ›´é«˜çº§çš„åŒæ­¥åŸè¯­ï¼Œé™¤éæ€§èƒ½æµ‹è¯•è¯æ˜åŸå­æ“ä½œç¡®å®èƒ½å¸¦æ¥æ˜¾è‘—æå‡ã€‚
                            </p>
                        </td>
                    </tr>
                </table>
                
                <div class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <p class="font-semibold text-blue-800">ä¸»è¦åŒºåˆ«:</p>
                    <ul class="list-disc ml-6 mt-2 text-blue-700 space-y-1">
                        <li>ç”¨æˆ·æ€æä¾›æ ‡å‡†C11/C++11æ¥å£ï¼Œè€Œå†…æ ¸å®ç°è‡ªå·±çš„APIä½“ç³»</li>
                        <li>å†…æ ¸æä¾›æ›´è¯¦ç»†çš„åŸå­æ“ä½œå˜ä½“ï¼ŒåŒ…æ‹¬ä¸ä¸­æ–­ç›¸å…³çš„ç‰ˆæœ¬</li>
                        <li>å†…æ ¸æ˜¾å¼åŒºåˆ†32ä½å’Œ64ä½åŸå­æ“ä½œï¼Œè€Œç”¨æˆ·æ€é€šå¸¸æ ¹æ®ç±»å‹è‡ªåŠ¨å¤„ç†</li>
                        <li>å†…æ ¸åŸå­æ“ä½œAPIè®¾è®¡æ›´é¢å‘åŠŸèƒ½ï¼ˆåŠ å‡ã€æµ‹è¯•ç­‰ï¼‰ï¼Œç”¨æˆ·æ€æ›´é¢å‘å†…å­˜æ¨¡å‹</li>
                        <li>å†…æ ¸æä¾›æ˜¾å¼çš„å†…å­˜å±éšœAPIï¼Œè€Œç”¨æˆ·æ€é€šè¿‡å†…å­˜åºå‚æ•°éšå¼æ§åˆ¶</li>
                        <li>å†…æ ¸é’ˆå¯¹ä¸åŒæ¶æ„æœ‰ä¸“é—¨ä¼˜åŒ–ï¼Œé€šå¸¸æ¯”ç”¨æˆ·æ€å®ç°æ›´é«˜æ•ˆ</li>
                        <li>å†…æ ¸APIå‘½åæ›´ç®€æ´ï¼Œæ›´å¼ºè°ƒåŠŸèƒ½è€ŒéæŠ½è±¡</li>
                        <li>å†…æ ¸APIæ›´å¼ºè°ƒSMPç³»ç»Ÿä¸Šçš„è¡Œä¸ºåŒºåˆ«</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
<script>window.parent.postMessage({ action: "ready" }, "*"); 
 
window.console = new Proxy(console, {
  get(target, prop) {
    if (['log', 'warn', 'error'].includes(prop)) {
      return new Proxy(target[prop], {
        apply(fn, thisArg, args) {
          fn.apply(thisArg, args);
          window.parent.postMessage({ action: 'console', 
            type: prop, 
            args: args.map((arg) => {
              try {
                return JSON.stringify(arg).replace(/^["']|["']$/g, '');
              } catch (e) {
                return arg;
              }
            }) 
          }, '*');
        }
      });
    }
    return target[prop];
  }
});
</script></body>
</html>